

# 概述

OpenPCDet是MMLab的一个计算机视觉项目（当然不是传统的二维计算机视觉），一个开源的点云检测工具箱（或者说三维计算机视觉），它是由香港中文大学多媒体实验室（MMLab）开发的。此项目的主要目的是提供一个开源和统一的代码库，来帮助研究人员和开发人员更好地进行基于点云的物体检测研究。

OpenPCDet支持多种流行的3D物体检测算法，如PointPillars, SECOND, Part-A^2等。它提供了一个灵活的代码框架，可以很方便的进行各种点云检测算法的训练和测试。并且，OpenPCDet还提供了很多预训练的模型，可以方便的进行迁移学习。

OpenPCDet的代码框架主要由以下部分组成：

1. `pcdet/models`: 这个目录包含了所有支持的点云检测模型的代码，每个模型都有一个对应的python文件，例如`pointpillars.py`。
2. `pcdet/datasets`: 这个目录包含了数据集的处理代码，包括数据读取、预处理和后处理等。支持KITTI, Waymo, nuScenes等多种数据集。
3. `pcdet/utils`: 这个目录包含了一些工具函数，例如点云操作、计算IoU等。
4. `tools`: 这个目录包含了训练和测试模型的主要脚本。
5. `configs`: 这个目录包含了各种模型的配置文件，可以在这里修改模型参数、训练参数等。
6. `data`：这个目录是用来存放各种数据集的，经典的有KITTI、Waymo等数据集
7. `docs`：包含一些文档和效果展示图

接下来我们尝试自顶向下的方式去解析这个框架的运行原理（就是有哪些模块，这些模块之间怎么搭配的，每个模块有什么功能，然后去研究每个模块怎么做的），然后去了解底层模型的搭建过程

## Tools

模型是封装好的，然后通过tools文件夹下的代码进行启动和运行，我们先查看这里的代码如何构建的

我们首先看一下文件的结构，我们先忽略其具体有哪些文件

```shell
.
├── cfgs
│   ├── dataset_configs
│   ├── kitti_models
│   ├── nuscenes_models
│   └── waymo_models
├── demo.py
├── eval_utils
│   └── eval_utils.py
├── test.py
├── train.py
├── train_utils
│   ├── optimization
│   │   ├── fastai_optim.py
│   │   ├── __init__.py
│   │   └── learning_schedules_fastai.py
│   └── train_utils.py
└── visual_utils
    └── visualize_utils.py
```

### cfgs

这个文件夹中是数据集的配置文件，具体的配置方式数据以yaml文件的格式给出，这些配置文件用于设置模型的各种参数，包括但不限于模型结构、训练策略、数据集路径等

当你要训练或测试一个模型时，你需要指定一个配置文件，OpenPCDet会根据配置文件中的设置来构建模型、读取数据以及设置训练策略。

配置文件使得你可以在不修改代码的情况下，调整模型的各种设置，使得实验更加灵活和方便。

### utils

通常都是用于提供一些实用函数或类的。具体来说：

1. `eval_utils`: 这个文件夹主要包含了一些用于评估模型性能的实用工具。例如，它可能包含了计算各种度量（如精度、召回率、mAP等）的函数，以及将评估结果可视化或保存的函数。对于点云检测任务，这可能还包括一些特定的评估工具，例如用于计算3D物体检测的IoU（Intersection over Union）的函数。
2. `train_utils`: 这个文件夹主要包含了一些用于训练模型的实用工具。例如，它可能包含了设置优化器、学习率调度器的函数，或者用于在训练过程中保存模型、记录训练日志的函数。
3. `test_utils`: 这个文件夹主要包含了一些用于测试模型的实用工具。例如，它可能包含了加载模型、处理输入数据、解析模型输出的函数，以及将测试结果可视化或保存的函数。

这些`utils`文件夹为OpenPCDet的训练、测试和评估流程提供了一些基础的实用工具，使得这些过程更加模块化和灵活。

### Python文件

这些文件相当于开关，可以一键启动整个项目，完成训练、验证等操作

# 功能模块详解

## 总开关——train.py等

这是一个一键启动的开关，包括test.py和train.py，我们先分析其中的功能

这个代码有三部分，第一部分是一系列的模块导入，第二部分是从命令行读取参数的函数，第三部分是综合配置的主函数，用来处理参数并且运行模型

### 参数配置

在`parse_config`函数中，使用argparse模块读取命令行参数

# 工程总结

## 总体框架

不同的项目，在项目主目录下，会分为若干文件夹，如下

- `config`：各种配置文件
- 模型文件夹：包含了各种所需的模型
- `docs`：各种文档和说明
- `tools`：工具程序，同时也是集成各个模块的程序文件所在（比如说train.py文件）
- `data`：存放各种数据集文件

这样处理的好处就是非常独立

## 代码集成

其中，代码往往集成在tools文件夹下的train.py文件中，这个文件的作用相当于总闸门总开关

在train.py文件中，程序大致分为三部分，一部分是开头导包，导入依赖，一部分是解析命令行参数的函数，可以让人在输入命令行的时候就可以给参数，一部分是主函数文件，用来运行整个项目

其中，导包的地方并没有需要特别说明的地方

然后就是解析命令行参数的函数，这个函数一般命名为`parse_args()`